export type ProcessingStyle='classic_longlens'|'mark1_fisheye'|'vx1000'|'crt_broadcast'|'liquid_slowmo'|'analog_degrade'|'nightshot'|'solarize';
export type SignUploadResponse={upload_url:string;gcs_uri:string}; export type ProcessResponse={youtube_url:string;vertical_url:string};
const API_BASE=(import.meta as any).env?.DEV?'/api':(((import.meta as any).env?.VITE_VX_API_BASE)||'https://vx-skate-processor-675304308102.us-central1.run.app');
export async function signUpload(filename:string,contentType:string):Promise<SignUploadResponse>{const r=await fetch(`${API_BASE}/sign-upload`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({filename,content_type:contentType||'video/mp4'})});if(!r.ok)throw new Error(`SIGN_UPLOAD_${r.status}`);return r.json();}
export async function uploadSigned(url:string,file:File):Promise<void>{const r=await fetch(url,{method:'PUT',headers:{'Content-Type':file.type||'video/mp4'},body:file});if(!r.ok)throw new Error(`UPLOAD_${r.status}: ${await r.text().catch(()=> '')}`);}
export async function processVideo(gcsUri:string,style:ProcessingStyle,opts?:{signal?:AbortSignal}):Promise<ProcessResponse>{const r=await fetch(`${API_BASE}/process`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({input_uri:gcsUri,style,output_prefix:'processed'}),signal:opts?.signal});if(!r.ok)throw new Error(`PROCESS_${r.status}: ${await r.text().catch(()=> '')}`);return r.json();}